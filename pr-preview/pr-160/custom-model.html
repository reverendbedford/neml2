<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>NEML2: Custom Model</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
window.MathJax = {
  options: {
    ignoreHtmlClass: 'tex2jax_ignore',
    processHtmlClass: 'tex2jax_process'
  },
  loader: {
    load: ['[tex]/ams','[tex]/physics','[tex]/boldsymbol']
  },
  tex: {
    macros: {},
    packages: ['base','configmacros','ams','physics','boldsymbol']
  }
};
</script>
<script type="text/javascript" id="MathJax-script" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">NEML2<span id="projectnumber">&#160;1.4.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('custom-model.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Custom Model</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#custom-model-model-description">Model description</a></li>
<li class="level1"><a href="#custom-model-variable-declaration">Variable declaration</a></li>
<li class="level1"><a href="#custom-model-parameter-declaration">Parameter declaration</a></li>
<li class="level1"><a href="#custom-model-in-code-documentation">In-code documentation</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md__2home_2runner_2work_2neml2_2neml2_2doc_2content_2dev_2custom__model"></a></p>
<h1><a class="anchor" id="custom-model-model-description"></a>
Model description</h1>
<p>The following tutorials serve as a developer-facing step-by-step guide for creating and testing a custom material model. A simple linear isotropic hardening is used as the example in this tutorial. The model can be mathematically written as  </p><p class="formulaDsp">
\begin{align*}
  h &amp;= K \bar{\varepsilon}^p,
\end{align*}
</p>
<p> where \(\bar{\varepsilon}^p\) is the equivalent plastic strain and \(h\) is the isotropic hardening. The input variable for this model is \(\boldsymbol{\varepsilon}\), the output variable for this model is \(k\), and the parameters of the model is \(K\).</p>
<h1><a class="anchor" id="custom-model-variable-declaration"></a>
Variable declaration</h1>
<p>The development of every model begins with the declaration and registration of its input and output variables. Here, we first define an abstract base class that will be later used to define the linear isotropic hardening relation. The abstract base class defines the isotropic hardening relation  </p><p class="formulaDsp">
\[
  h = f\left( \bar{\varepsilon}^p \right),
\]
</p>
<p> mapping the equivalent plastic strain to the isotropic hardening. The base class is named <code>IsotropicHardening</code> following the <a class="el" href="naming-conventions.html">naming conventions</a>. The header file <a class="el" href="classneml2_1_1IsotropicHardening.html">IsotropicHardening.h</a> is displayed below </p><div class="fragment"><div class="line"><span class="preprocessor">#pragma once</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;neml2/models/Model.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span><a class="code hl_namespace" href="namespaceneml2.html">neml2</a></div>
<div class="line">{</div>
<div class="line"><span class="keyword">class </span>IsotropicHardening : <span class="keyword">public</span> Model</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  <span class="keyword">static</span> OptionSet <a class="code hl_function" href="classneml2_1_1IsotropicHardening.html#acec712ff48d4c0884a1362c116f3257a">expected_options</a>();</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_function" href="classneml2_1_1IsotropicHardening.html#aa1a9bb4383495d684fe4c362ebcfe33e">IsotropicHardening</a>(<span class="keyword">const</span> OptionSet &amp; <a class="code hl_function" href="classneml2_1_1Model.html#a761d77eb7c81c3e93b34bfe6caf4b132">options</a>);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">protected</span>:</div>
<div class="line">  <span class="comment">// Equivalent plastic strain</span></div>
<div class="line">  <span class="keyword">const</span> Variable&lt;Scalar&gt; &amp; <a class="code hl_variable" href="classneml2_1_1IsotropicHardening.html#acb1d8d5cc3d18f5bb60c7dbe0728b2e6">_ep</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Isotropic hardening</span></div>
<div class="line">  Variable&lt;Scalar&gt; &amp; <a class="code hl_variable" href="classneml2_1_1IsotropicHardening.html#a6f044520b142b400e7de828da3fd94d0">_h</a>;</div>
<div class="line">};</div>
<div class="line">} <span class="comment">// namespace neml2</span></div>
<div class="ttc" id="aclassneml2_1_1IsotropicHardening_html_a6f044520b142b400e7de828da3fd94d0"><div class="ttname"><a href="classneml2_1_1IsotropicHardening.html#a6f044520b142b400e7de828da3fd94d0">neml2::IsotropicHardening::_h</a></div><div class="ttdeci">Variable&lt; Scalar &gt; &amp; _h</div><div class="ttdoc">Isotropic hardening.</div><div class="ttdef"><b>Definition</b> IsotropicHardening.h:43</div></div>
<div class="ttc" id="aclassneml2_1_1IsotropicHardening_html_aa1a9bb4383495d684fe4c362ebcfe33e"><div class="ttname"><a href="classneml2_1_1IsotropicHardening.html#aa1a9bb4383495d684fe4c362ebcfe33e">neml2::IsotropicHardening::IsotropicHardening</a></div><div class="ttdeci">IsotropicHardening(const OptionSet &amp;options)</div><div class="ttdef"><b>Definition</b> IsotropicHardening.cxx:44</div></div>
<div class="ttc" id="aclassneml2_1_1IsotropicHardening_html_acb1d8d5cc3d18f5bb60c7dbe0728b2e6"><div class="ttname"><a href="classneml2_1_1IsotropicHardening.html#acb1d8d5cc3d18f5bb60c7dbe0728b2e6">neml2::IsotropicHardening::_ep</a></div><div class="ttdeci">const Variable&lt; Scalar &gt; &amp; _ep</div><div class="ttdoc">Equivalent plastic strain.</div><div class="ttdef"><b>Definition</b> IsotropicHardening.h:40</div></div>
<div class="ttc" id="aclassneml2_1_1IsotropicHardening_html_acec712ff48d4c0884a1362c116f3257a"><div class="ttname"><a href="classneml2_1_1IsotropicHardening.html#acec712ff48d4c0884a1362c116f3257a">neml2::IsotropicHardening::expected_options</a></div><div class="ttdeci">static OptionSet expected_options()</div><div class="ttdef"><b>Definition</b> IsotropicHardening.cxx:30</div></div>
<div class="ttc" id="aclassneml2_1_1Model_html_a761d77eb7c81c3e93b34bfe6caf4b132"><div class="ttname"><a href="classneml2_1_1Model.html#a761d77eb7c81c3e93b34bfe6caf4b132">neml2::Model::options</a></div><div class="ttdeci">const torch::TensorOptions &amp; options() const</div><div class="ttdoc">This model's tensor options.</div><div class="ttdef"><b>Definition</b> Model.h:122</div></div>
<div class="ttc" id="anamespaceneml2_html"><div class="ttname"><a href="namespaceneml2.html">neml2</a></div><div class="ttdef"><b>Definition</b> CrossRef.cxx:32</div></div>
</div><!-- fragment --><p> Since isotropic hardening <em>is a</em> model, the class inherits from <code>Model</code>. The user-facing expected options are defined by the static method <code>expected_options</code>. NEML2 handles the parsing of user-specified options and pass them to the constructor (see <a class="el" href="input-file.html#input-file-syntax">Input file syntax</a> on how the input file works). The input variable of the model is the equivalent plastic strain, and the output variable of the model is the isotropic hardening. Their corresponding variable value references are stored as <code>_ep</code> and <code>_h</code>, respectively, again following the <a class="el" href="naming-conventions.html">naming conventions</a>.</p>
<p>The expected options and the constructor are defined as </p><div class="fragment"><div class="line"><span class="preprocessor">#include &quot;neml2/models/solid_mechanics/IsotropicHardening.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span><a class="code hl_namespace" href="namespaceneml2.html">neml2</a></div>
<div class="line">{</div>
<div class="line">OptionSet</div>
<div class="line"><a class="code hl_function" href="classneml2_1_1IsotropicHardening.html#acec712ff48d4c0884a1362c116f3257a">IsotropicHardening::expected_options</a>()</div>
<div class="line">{</div>
<div class="line">  OptionSet <a class="code hl_function" href="classneml2_1_1Model.html#a761d77eb7c81c3e93b34bfe6caf4b132">options</a> = <a class="code hl_function" href="classneml2_1_1Model.html#acec712ff48d4c0884a1362c116f3257a">Model::expected_options</a>();</div>
<div class="line">  <a class="code hl_function" href="classneml2_1_1Model.html#a761d77eb7c81c3e93b34bfe6caf4b132">options</a>.set&lt;<a class="code hl_typedef" href="namespaceneml2.html#a9e1488821b46ffc106c90ab80036b7aa">VariableName</a>&gt;(<span class="stringliteral">&quot;equivalent_plastic_strain&quot;</span>) = <a class="code hl_typedef" href="namespaceneml2.html#a9e1488821b46ffc106c90ab80036b7aa">VariableName</a>(<span class="stringliteral">&quot;state&quot;</span>, <span class="stringliteral">&quot;internal&quot;</span>, <span class="stringliteral">&quot;ep&quot;</span>);</div>
<div class="line">  <a class="code hl_function" href="classneml2_1_1Model.html#a761d77eb7c81c3e93b34bfe6caf4b132">options</a>.set&lt;<a class="code hl_typedef" href="namespaceneml2.html#a9e1488821b46ffc106c90ab80036b7aa">VariableName</a>&gt;(<span class="stringliteral">&quot;isotropic_hardening&quot;</span>) = <a class="code hl_typedef" href="namespaceneml2.html#a9e1488821b46ffc106c90ab80036b7aa">VariableName</a>(<span class="stringliteral">&quot;state&quot;</span>, <span class="stringliteral">&quot;internal&quot;</span>, <span class="stringliteral">&quot;k&quot;</span>);</div>
<div class="line">  <span class="keywordflow">return</span> <a class="code hl_function" href="classneml2_1_1Model.html#a761d77eb7c81c3e93b34bfe6caf4b132">options</a>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code hl_function" href="classneml2_1_1IsotropicHardening.html#aa1a9bb4383495d684fe4c362ebcfe33e">IsotropicHardening::IsotropicHardening</a>(<span class="keyword">const</span> OptionSet &amp; options)</div>
<div class="line">  : Model(options),</div>
<div class="line">    _ep(declare_input_variable&lt;Scalar&gt;(<span class="stringliteral">&quot;equivalent_plastic_strain&quot;</span>)),</div>
<div class="line">    _h(declare_output_variable&lt;Scalar&gt;(<span class="stringliteral">&quot;isotropic_hardening&quot;</span>))</div>
<div class="line">{</div>
<div class="line">}</div>
<div class="line">} <span class="comment">// namespace neml2</span></div>
<div class="ttc" id="aclassneml2_1_1Model_html_acec712ff48d4c0884a1362c116f3257a"><div class="ttname"><a href="classneml2_1_1Model.html#acec712ff48d4c0884a1362c116f3257a">neml2::Model::expected_options</a></div><div class="ttdeci">static OptionSet expected_options()</div><div class="ttdef"><b>Definition</b> Model.cxx:32</div></div>
<div class="ttc" id="anamespaceneml2_html_a9e1488821b46ffc106c90ab80036b7aa"><div class="ttname"><a href="namespaceneml2.html#a9e1488821b46ffc106c90ab80036b7aa">neml2::VariableName</a></div><div class="ttdeci">LabeledAxisAccessor VariableName</div><div class="ttdef"><b>Definition</b> Variable.h:35</div></div>
</div><!-- fragment --><p> Recall that variable names on <code>LabeledAxis</code> are always fully qualified, the equivalent plastic strain and the isotropic hardening are denoted as "state/internal/ep" and "state/internal/k", respectively. An instance of the class is constructed by extracting user-specified options (of type <code>OptionSet</code>). Note how <code>declare_input_variable&lt;Scalar&gt;</code> and <code>declare_output_variable&lt;Scalar&gt;</code> are used to declare and register the input and output variables.</p>
<h1><a class="anchor" id="custom-model-parameter-declaration"></a>
Parameter declaration</h1>
<p>Now that the abstract base class <code>IsotropicHardening</code> has been implemented, we are ready to define our first concrete NEML2 model that describes a linear isotropic hardening relation  </p><p class="formulaDsp">
\[
  h = K \bar{\varepsilon}^p.
\]
</p>
<p> Note that \(K\) is a model parameter. Following the naming convention, the concrete class is named <code>LinearIsotropicHardening</code>. The header file is displayed below. </p><div class="fragment"><div class="line"><span class="preprocessor">#pragma once</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;neml2/models/solid_mechanics/IsotropicHardening.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span><a class="code hl_namespace" href="namespaceneml2.html">neml2</a></div>
<div class="line">{</div>
<div class="line"><span class="comment">// Simple linear map between equivalent strain and isotropic hardening</span></div>
<div class="line"><span class="keyword">class </span>LinearIsotropicHardening : <span class="keyword">public</span> IsotropicHardening</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  <span class="keyword">static</span> OptionSet <a class="code hl_function" href="classneml2_1_1LinearIsotropicHardening.html#acec712ff48d4c0884a1362c116f3257a">expected_options</a>();</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_function" href="classneml2_1_1LinearIsotropicHardening.html#aaaaad6f26335889463eda2389411ea0f">LinearIsotropicHardening</a>(<span class="keyword">const</span> OptionSet &amp; <a class="code hl_function" href="classneml2_1_1Model.html#a761d77eb7c81c3e93b34bfe6caf4b132">options</a>);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">protected</span>:</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code hl_function" href="classneml2_1_1LinearIsotropicHardening.html#af5600a36813e455aefee72bec1d574fb">set_value</a>(<span class="keywordtype">bool</span> out, <span class="keywordtype">bool</span> dout_din, <span class="keywordtype">bool</span> d2out_din2) <span class="keyword">override</span>;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// The linear isotropic hardening modulus</span></div>
<div class="line">  <span class="keyword">const</span> Scalar &amp; <a class="code hl_variable" href="classneml2_1_1LinearIsotropicHardening.html#aa0dde0f9a60dafc1c8b755d657499c7d">_K</a>;</div>
<div class="line">};</div>
<div class="line">} <span class="comment">// namespace neml2</span></div>
<div class="ttc" id="aclassneml2_1_1LinearIsotropicHardening_html_aa0dde0f9a60dafc1c8b755d657499c7d"><div class="ttname"><a href="classneml2_1_1LinearIsotropicHardening.html#aa0dde0f9a60dafc1c8b755d657499c7d">neml2::LinearIsotropicHardening::_K</a></div><div class="ttdeci">const Scalar &amp; _K</div><div class="ttdoc">The linear isotropic hardening modulus.</div><div class="ttdef"><b>Definition</b> LinearIsotropicHardening.h:46</div></div>
<div class="ttc" id="aclassneml2_1_1LinearIsotropicHardening_html_aaaaad6f26335889463eda2389411ea0f"><div class="ttname"><a href="classneml2_1_1LinearIsotropicHardening.html#aaaaad6f26335889463eda2389411ea0f">neml2::LinearIsotropicHardening::LinearIsotropicHardening</a></div><div class="ttdeci">LinearIsotropicHardening(const OptionSet &amp;options)</div><div class="ttdef"><b>Definition</b> LinearIsotropicHardening.cxx:44</div></div>
<div class="ttc" id="aclassneml2_1_1LinearIsotropicHardening_html_acec712ff48d4c0884a1362c116f3257a"><div class="ttname"><a href="classneml2_1_1LinearIsotropicHardening.html#acec712ff48d4c0884a1362c116f3257a">neml2::LinearIsotropicHardening::expected_options</a></div><div class="ttdeci">static OptionSet expected_options()</div><div class="ttdef"><b>Definition</b> LinearIsotropicHardening.cxx:32</div></div>
<div class="ttc" id="aclassneml2_1_1LinearIsotropicHardening_html_af5600a36813e455aefee72bec1d574fb"><div class="ttname"><a href="classneml2_1_1LinearIsotropicHardening.html#af5600a36813e455aefee72bec1d574fb">neml2::LinearIsotropicHardening::set_value</a></div><div class="ttdeci">void set_value(bool out, bool dout_din, bool d2out_din2) override</div><div class="ttdoc">The map between input -&gt; output, and optionally its derivatives.</div><div class="ttdef"><b>Definition</b> LinearIsotropicHardening.cxx:51</div></div>
</div><!-- fragment --><p> It derives from the abstract base class <code>IsotropicHardening</code> and implements the method <code>set_value</code> as the forward operator. The model parameter \(K\) is stored as a protected member variable <code>_K</code>. The model implementation is shown below. </p><div class="fragment"><div class="line"><span class="preprocessor">#include &quot;neml2/models/solid_mechanics/LinearIsotropicHardening.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span><a class="code hl_namespace" href="namespaceneml2.html">neml2</a></div>
<div class="line">{</div>
<div class="line">register_NEML2_object(LinearIsotropicHardening);</div>
<div class="line"> </div>
<div class="line">OptionSet</div>
<div class="line"><a class="code hl_function" href="classneml2_1_1LinearIsotropicHardening.html#acec712ff48d4c0884a1362c116f3257a">LinearIsotropicHardening::expected_options</a>()</div>
<div class="line">{</div>
<div class="line">  OptionSet <a class="code hl_function" href="classneml2_1_1Model.html#a761d77eb7c81c3e93b34bfe6caf4b132">options</a> = <a class="code hl_function" href="classneml2_1_1IsotropicHardening.html#acec712ff48d4c0884a1362c116f3257a">IsotropicHardening::expected_options</a>();</div>
<div class="line">  <a class="code hl_function" href="classneml2_1_1Model.html#a761d77eb7c81c3e93b34bfe6caf4b132">options</a>.set&lt;CrossRef&lt;Scalar&gt;&gt;(<span class="stringliteral">&quot;hardening_modulus&quot;</span>);</div>
<div class="line">  <span class="keywordflow">return</span> <a class="code hl_function" href="classneml2_1_1Model.html#a761d77eb7c81c3e93b34bfe6caf4b132">options</a>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code hl_function" href="classneml2_1_1LinearIsotropicHardening.html#aaaaad6f26335889463eda2389411ea0f">LinearIsotropicHardening::LinearIsotropicHardening</a>(<span class="keyword">const</span> OptionSet &amp; options)</div>
<div class="line">  : IsotropicHardening(options),</div>
<div class="line">    _K(declare_parameter&lt;Scalar&gt;(<span class="stringliteral">&quot;K&quot;</span>, <span class="stringliteral">&quot;hardening_modulus&quot;</span>))</div>
<div class="line">{</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">LinearIsotropicHardening::set_value(<span class="keywordtype">bool</span> out, <span class="keywordtype">bool</span> dout_din, <span class="keywordtype">bool</span> d2out_din2)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">if</span> (out)</div>
<div class="line">    _h = _K * _ep;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (dout_din)</div>
<div class="line">    _h.d(_ep) = _K;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (d2out_din2)</div>
<div class="line">  {</div>
<div class="line">    <span class="comment">// zero</span></div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line">} <span class="comment">// namespace neml2</span></div>
</div><!-- fragment --><p> Note that an additional option named "hardening_modulus" is requested from the user. The model parameter is registered using the API <code>declare_parameter&lt;Scalar&gt;</code>. In the <code>set_value</code> method, the current value of the input variable, equivalent plastic strain, is stored in the member <code>_ep</code>, and so the isotropic hardening can be computed as </p><div class="fragment"><div class="line">_K * _ep</div>
</div><!-- fragment --><p> The computed result is copied into the model output variable <code>_h</code> by </p><div class="fragment"><div class="line">_h = _K * _ep;</div>
</div><!-- fragment --><p> In addition, the first derivative of the forward operator is defined as </p><div class="fragment"><div class="line">_h.d(_ep) = _K;</div>
</div><!-- fragment --><p> Last but not the least, the model is registed in the NEML2 model factory using the macro </p><div class="fragment"><div class="line">register_NEML2_object(LinearIsotropicHardening);</div>
</div><!-- fragment --><p> so that an instance of the class can be created at runtime.</p>
<h1><a class="anchor" id="custom-model-in-code-documentation"></a>
In-code documentation</h1>
<p>In the examples above, we have added Doxygen-style in-code documentation for the class and member variables. These documentation strings are automatically parsed and translated by Doxygen, and the resulting page can be found at <a class="el" href="classneml2_1_1LinearIsotropicHardening.html" title="Simple linear map between equivalent strain and isotropic hardening.">neml2::LinearIsotropicHardening</a>.</p>
<p>On the other hand, as the number of models grows, it becomes increasingly challenging to maintain a list of input file options so that users can refer to. For example, the input file syntax for specifying <code>LinearIsotropicHardening</code> is shown below </p><div class="fragment"><div class="line">[Models]</div>
<div class="line">  [my_custom_model]</div>
<div class="line">    type = LinearIsotropicHardening</div>
<div class="line">    equivalent_plastic_strain = <span class="stringliteral">&#39;state/internal/ep&#39;</span></div>
<div class="line">    isotropic_hardening = <span class="stringliteral">&#39;state/internal/h&#39;</span></div>
<div class="line">    hardening_modulus = 1000</div>
<div class="line">  []</div>
<div class="line">[]</div>
</div><!-- fragment --><p> Some natural questions are, how is the user supposed to know, without inspecting the source code,</p><ul>
<li>the name of the object (e.g., "LinearIsotropicHardening")</li>
<li>the object's functionalities (e.g., the underlying mathematical description)</li>
<li>the option names (e.g., "equivalent_plastic_strain", "isotropic_hardening", and "hardening_modulus")</li>
<li>that some options are optional, while others are mandatary</li>
<li>the default values of optional input file options</li>
</ul>
<p>Doxygen-style in-code documentation cannot directly address the above issues. Therefore, NEML2 provides another form of in-code documentation to generate the so-called Syntax Documentation.</p>
<p>Again, using the <code>IsotropicHardening</code> as an example, the following in-code documentation can be added in the <code>expected_options</code> method: </p><div class="fragment"><div class="line">OptionSet</div>
<div class="line">IsotropicHardening::expected_options()</div>
<div class="line">{</div>
<div class="line">  OptionSet options = Model::expected_options();</div>
<div class="line">  options.doc() = <span class="stringliteral">&quot;Map equivalent plastic strain to isotropic hardening&quot;</span>;</div>
<div class="line"> </div>
<div class="line">  options.set&lt;VariableName&gt;(<span class="stringliteral">&quot;equivalent_plastic_strain&quot;</span>) = VariableName(<span class="stringliteral">&quot;state&quot;</span>, <span class="stringliteral">&quot;internal&quot;</span>, <span class="stringliteral">&quot;ep&quot;</span>);</div>
<div class="line">  options.set(<span class="stringliteral">&quot;equivalent_plastic_strain&quot;</span>).doc() = <span class="stringliteral">&quot;Equivalent plastic strain&quot;</span>;</div>
<div class="line"> </div>
<div class="line">  options.set&lt;VariableName&gt;(<span class="stringliteral">&quot;isotropic_hardening&quot;</span>) = VariableName(<span class="stringliteral">&quot;state&quot;</span>, <span class="stringliteral">&quot;internal&quot;</span>, <span class="stringliteral">&quot;k&quot;</span>);</div>
<div class="line">  options.set(<span class="stringliteral">&quot;isotropic_hardening&quot;</span>).doc() = <span class="stringliteral">&quot;Isotropic hardening&quot;</span>;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> options;</div>
<div class="line">}</div>
</div><!-- fragment --><div class="fragment"><div class="line">OptionSet</div>
<div class="line">LinearIsotropicHardening::expected_options()</div>
<div class="line">{</div>
<div class="line">  OptionSet options = IsotropicHardening::expected_options();</div>
<div class="line">  options.doc() += <span class="stringliteral">&quot; following a linear relationship, i.e., \\f$ h = K \\varepsilon_p \\f$ where &quot;</span></div>
<div class="line">                   <span class="stringliteral">&quot;\\f$ K \\f$ is the hardening modulus.&quot;</span>;</div>
<div class="line"> </div>
<div class="line">  options.set&lt;CrossRef&lt;Scalar&gt;&gt;(<span class="stringliteral">&quot;hardening_modulus&quot;</span>);</div>
<div class="line">  options.set(<span class="stringliteral">&quot;hardening_modulus&quot;</span>).doc() = <span class="stringliteral">&quot;Hardening modulus&quot;</span>;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> options;</div>
<div class="line">}</div>
</div><!-- fragment --><p> The object description is added using <a class="el" href="classneml2_1_1OptionSet.html#a95ddf7f84b4944b035c3f05fab305f99" title="A readonly reference to the option set&#39;s docstring.">neml2::OptionSet::doc</a>, and each expected option is accompanied with a brief explanation. NEML2 can then automatically extract and build the <a class="el" href="syntax-models.html#linearisotropichardening">syntax documentation</a>. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0 </li>
  </ul>
</div>
</body>
</html>
