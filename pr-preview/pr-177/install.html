<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>NEML2: Installation Guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
window.MathJax = {
  options: {
    ignoreHtmlClass: 'tex2jax_ignore',
    processHtmlClass: 'tex2jax_process'
  },
  loader: {
    load: ['[tex]/ams','[tex]/physics','[tex]/boldsymbol']
  },
  tex: {
    macros: {},
    packages: ['base','configmacros','ams','physics','boldsymbol']
  }
};
</script>
<script type="text/javascript" id="MathJax-script" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">NEML2<span id="projectnumber">&#160;2.0.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('install.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Installation Guide</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md12">Prerequisites</a></li>
<li class="level1"><a href="#autotoc_md13">Dependencies</a><ul><li class="level2"><a href="#autotoc_md14">Required dependencies</a></li>
<li class="level2"><a href="#autotoc_md15">Optional dependencies</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md16">Build and install</a><ul><li class="level2"><a href="#autotoc_md17">C++ backend</a></li>
<li class="level2"><a href="#autotoc_md18">Python package</a></li>
</ul>
</li>
<li class="level1"><a href="#install-build-customization">Build customization</a></li>
<li class="level1"><a href="#install-cmake-integration">CMake integration</a></li>
<li class="level1"><a href="#install-testing">Testing</a><ul><li class="level2"><a href="#autotoc_md19">C++ backend</a></li>
<li class="level2"><a href="#autotoc_md20">Python package</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md__2home_2runner_2work_2neml2_2neml2_2doc_2content_2install"></a></p>
<h1><a class="anchor" id="autotoc_md12"></a>
Prerequisites</h1>
<p>Compiling the NEML2 core library requires</p><ul>
<li>A C++ compiler with C++17 support</li>
<li>CMake &gt;= 3.28</li>
</ul>
<h1><a class="anchor" id="autotoc_md13"></a>
Dependencies</h1>
<h2><a class="anchor" id="autotoc_md14"></a>
Required dependencies</h2>
<ul>
<li><a href="https://pytorch.org/get-started/locally/">PyTorch</a>, version 2.5.1.</li>
</ul>
<p>Recent PyTorch releases within a few minor versions are likely to be compatible. In the PyTorch official download page, several download options are provided: conda, pip, libTorch, and source distribution.</p><ul>
<li><b>Recommended</b>: If you choose to download PyTorch using conda or pip, the NEML2 CMake script can automatically detect and use the PyTorch installation.</li>
<li>If you choose to download libTorch or build PyTorch from source, you will need to set <code>LIBTORCH_DIR</code> to be the location of libTorch when using CMake to configure NEML2.</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>The libTorch distributions from the official website come with two flavors: "Pre-cxx11 ABI" and "cxx11 ABI". Both variants are supported by NEML2. If you are unsure, we recommend the one with "cxx11 ABI".</dd></dl>
<p>If no PyTorch installation can be detected and <code>LIBTORCH_DIR</code> is not set at configure time, the NEML2 CMake script will automatically download and use the libTorch obtained from the official website. Note, however, that this method only works on Linux and Mac systems.</p>
<dl class="section note"><dt>Note</dt><dd>We strive to keep up with the rapid development of PyTorch. The NEML2 PyTorch dependency is updated on a quarterly basis. If there is a particular version of PyTorch you'd like to use which is found to be incompatible with NEML2, please feel free to <a href="https://github.com/applied-material-modeling/neml2/issues">create an issue</a>.</dd></dl>
<h2><a class="anchor" id="autotoc_md15"></a>
Optional dependencies</h2>
<dl class="section note"><dt>Note</dt><dd>No action is needed to manually obtain the optional dependencies. The compatible optional dependencies will be automatically downloaded and configured by CMake depending on the build customization.</dd></dl>
<ul>
<li><a href="https://github.com/idaholab/moose/tree/master/framework/contrib/hit">HIT</a> for input file parsing.</li>
<li><a href="https://code.ornl.gov/neams-workbench/wasp">WASP</a> as the lexing and parsing backend for HIT.</li>
<li><a href="https://github.com/catchorg/Catch2">Catch2</a> for unit and regression testing.</li>
<li><a href="https://github.com/gperftools/gperftools">gperftools</a> for profiling.</li>
<li><a href="https://github.com/doxygen/doxygen">Doxygen</a> for building the documentation.</li>
<li><a href="https://github.com/jothepro/doxygen-awesome-css">Doxygen Awesome</a> the documentation theme.</li>
<li><a href="https://github.com/p-ranav/argparse">argparse</a> for command-line argument parsing.</li>
<li><a href="https://github.com/pybind/pybind11">pybind11</a> for building Python bindings.</li>
<li>Python packages<ul>
<li><a href="https://github.com/xflr6/graphviz">graphviz</a> for model visualization</li>
<li><a href="https://docs.pytest.org/en/stable/index.html">pytest</a> for testing Pythin bindings</li>
<li><a href="https://pyyaml.org/">PyYAML</a> for extracting syntax documentation</li>
<li><a href="https://github.com/sizmailov/pybind11-stubgen">pybind11-stubgen</a> for extracting stubs from Python bindings</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md16"></a>
Build and install</h1>
<dl class="section note"><dt>Note</dt><dd>NEML2 is available both as a C++ library and as a Python package. Instructions for building and installing each variant are provided below. If you only need one of them, the other can be skipped.</dd></dl>
<h2><a class="anchor" id="autotoc_md17"></a>
C++ backend</h2>
<p>First, obtain the NEML2 source code.</p>
<div class="fragment"><div class="line">git clone https://github.com/applied-material-modeling/neml2.git</div>
<div class="line">cd neml2</div>
<div class="line">git checkout main</div>
</div><!-- fragment --><p>Then, configure NEML2. See <a class="el" href="#install-build-customization">build customization</a> for possible configuration options.</p>
<div class="fragment"><div class="line">cmake -B build .</div>
</div><!-- fragment --><p>Finally, compile NEML2.</p>
<div class="fragment"><div class="line">cmake --build build -j N</div>
</div><!-- fragment --><p> where <code>N</code> is the number of cores to use for parallel compilation.</p>
<p>The compiled NEML2 can be installed as a system library.</p>
<div class="fragment"><div class="line">cmake --install build</div>
</div><!-- fragment --><p>For more fine-grained control over the configure, build, and install commands, please refer to the <a href="https://cmake.org/cmake/help/latest/manual/cmake.1.html">CMake documentation</a>.</p>
<h2><a class="anchor" id="autotoc_md18"></a>
Python package</h2>
<p>NEML2 also provides an <em>experimental</em> Python package which provides bindings for the primitive tensors and parsers for deserializing and running material models. Package source distributions are available on PyPI, but package wheels are currently not built and uploaded to PyPI.</p>
<p>To install the NEML2 Python package, run the following command at the repository's root. Note that unlike the C++ backend, we do not expose any interface for customizing the build. The default configuration is already optimized for building the Python package.</p>
<div class="fragment"><div class="line">pip install -v .</div>
</div><!-- fragment --><p>The command installs a package named <code>neml2</code> to the site-packages directory, and so it can be imported in Python scripts using</p>
<div class="fragment"><div class="line"><span class="keyword">import</span> neml2</div>
</div><!-- fragment --><p>For security reasons, static analysis tools and IDEs for Python usually refuse to extract function signature, type hints, etc. from binary extensions such as the NEML2 Python bindings. As a workaround, NEML2 automatically generates "stubs" using <code>pybind11-stubgen</code> immediately after Python bindings are built to make them less opaque. Refer to the <a href="https://pypi.org/project/pybind11-stubgen/">pybind11-stubgen documentation</a> for more information.</p>
<h1><a class="anchor" id="install-build-customization"></a>
Build customization</h1>
<p>Additional configuration options can be passed via command line using the <code>-DOPTION</code> or <code>-DOPTION=ON</code> format. For example,</p>
<div class="fragment"><div class="line">cmake -DNEML2_PYBIND=ON -B build .</div>
</div><!-- fragment --><p> turns on the <code>NEML2_PYBIND</code> option, and additional targets for building the Python bindings will be created. Note that this would also download additional optional dependencies, e.g., pybind11, that are required to build the Python bindings.</p>
<p>Commonly used configuration options are summarized below. Default options are <u>underlined</u>.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Option   </th><th class="markdownTableHeadLeft">Values (<u>default</u>)   </th><th class="markdownTableHeadLeft">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">CMAKE_BUILD_TYPE   </td><td class="markdownTableBodyLeft"><u>Debug</u>, Release, MinSizeRel, RelWithDebInfo, Coverage   </td><td class="markdownTableBodyLeft">CMake <a href="https://cmake.org/cmake/help/latest/variable/CMAKE_BUILD_TYPE.html">Reference</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">CMAKE_INSTALL_PREFIX   </td><td class="markdownTableBodyLeft"></td><td class="markdownTableBodyLeft">CMake <a href="https://cmake.org/cmake/help/latest/variable/CMAKE_INSTALL_PREFIX.html">Reference</a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">CMAKE_UNITY_BUILD   </td><td class="markdownTableBodyLeft"></td><td class="markdownTableBodyLeft">CMake <a href="https://cmake.org/cmake/help/latest/variable/CMAKE_UNITY_BUILD.html">Reference</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">NEML2_TESTS   </td><td class="markdownTableBodyLeft"><u>ON</u>, OFF   </td><td class="markdownTableBodyLeft">Master knob for including/excluding all tests    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">NEML2_UNIT   </td><td class="markdownTableBodyLeft"><u>ON</u>, OFF   </td><td class="markdownTableBodyLeft">Create the unit testing target    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">NEML2_REGRESSION   </td><td class="markdownTableBodyLeft"><u>ON</u>, OFF   </td><td class="markdownTableBodyLeft">Create the regression testing target    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">NEML2_VERIFICATION   </td><td class="markdownTableBodyLeft"><u>ON</u>, OFF   </td><td class="markdownTableBodyLeft">Create the verification testing target    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">NEML2_RUNNER   </td><td class="markdownTableBodyLeft">ON, <u>OFF</u>   </td><td class="markdownTableBodyLeft">Create a simple runner    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">NEML2_CPU_PROFILER   </td><td class="markdownTableBodyLeft">ON, <u>OFF</u>   </td><td class="markdownTableBodyLeft">Linking against gperftools libprofiler to enable CPU profiling    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">NEML2_DOC   </td><td class="markdownTableBodyLeft">ON, <u>OFF</u>   </td><td class="markdownTableBodyLeft">Create the documentation target    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">NEML2_PYBIND   </td><td class="markdownTableBodyLeft">ON, <u>OFF</u>   </td><td class="markdownTableBodyLeft">Create the Python bindings target    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">NEML2_CLANG_TIDY   </td><td class="markdownTableBodyLeft">ON, <u>OFF</u>   </td><td class="markdownTableBodyLeft">Run clang-tidy linting diagnostics    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">NEML2_CLANG_TIDY_PATH   </td><td class="markdownTableBodyLeft"><u>"clang-tidy"</u>   </td><td class="markdownTableBodyLeft">Path to clang-tidy executable   </td></tr>
</table>
<p>Visual Studio Code users are encouraged to use the predefined <a href="https://vector-of-bool.github.io/docs/vscode-cmake-tools/variants.html">CMake variants</a> in <code>cmake-variants.yaml</code> to configure the build.</p>
<h1><a class="anchor" id="install-cmake-integration"></a>
CMake integration</h1>
<p>Integrating NEML2 into a project that already uses CMake is fairly straightforward. The following CMakeLists.txt snippet links NEML2 into the target executable called <code>foo</code>:</p>
<div class="fragment"><div class="line">add_subdirectory(neml2)</div>
<div class="line"> </div>
<div class="line">add_executable(foo main.cxx)</div>
<div class="line">target_link_libraries(foo neml2)</div>
</div><!-- fragment --><p>The above snippet assumes NEML2 is checked out to the directory neml2, i.e., as a git submodule. Alternatively, you may use CMake's <code>FetchContent</code> module to integrate NEML2 into your project:</p>
<div class="fragment"><div class="line">FetchContent_Declare(</div>
<div class="line">  neml2</div>
<div class="line">  GIT_REPOSITORY https://github.com/applied-material-modeling/neml2.git</div>
<div class="line">  GIT_TAG v2.0.0</div>
<div class="line">)</div>
<div class="line">FetchContent_MakeAvailable(neml2)</div>
<div class="line"> </div>
<div class="line">add_executable(foo main.cxx)</div>
<div class="line">target_link_libraries(foo neml2)</div>
</div><!-- fragment --><h1><a class="anchor" id="install-testing"></a>
Testing</h1>
<h2><a class="anchor" id="autotoc_md19"></a>
C++ backend</h2>
<p>By default when <code>NEML2_TESTS</code> is set to <code>ON</code>, three test suites are built under the specified build directory:</p>
<ul>
<li><code>tests/unit/unit_tests</code>: Collection of tests to ensure individual objects are working correctly.</li>
<li><code>tests/regression/regression_tests</code>: Collection of tests to avoid regression.</li>
<li><code>tests/verification/verification_tests</code>: Collection of verification problems.</li>
</ul>
<p>The tests assume the working directory to be the <code>tests</code> directory relative to the repository root. For Visual Studio Code users, the <a href="https://github.com/matepek/vscode-catch2-test-adapter">C++ TestMate</a> extension can be used to automatically discover and run tests. In the extension settings, the "Working Directory" variable should be modified to <code>${workspaceFolder}/tests</code>. The <code>settings.json</code> file shall contain the following entry: </p><div class="fragment"><div class="line">{</div>
<div class="line">  &quot;testMate.cpp.test.workingDirectory&quot;: &quot;${workspaceFolder}/tests&quot;,</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md20"></a>
Python package</h2>
<p>A collection of tests are available under <code>python/tests</code> to ensure the NEML2 Python package is working correctly. For Visual Studio Code users, the <a href="https://github.com/Microsoft/vscode-python">Python</a> extension can be used to automatically discover and run tests. In the extension settings, the "Pytest Enabled" variable shall be set to true. In addition, "pytestArgs" shall provide the location of tests, i.e. "${workspaceFolder}/python/tests". The <code>settings.json</code> file shall contain the following entries: </p><div class="fragment"><div class="line">{</div>
<div class="line">  &quot;python.testing.pytestEnabled&quot;: true,</div>
<div class="line">  &quot;python.testing.pytestArgs&quot;: [</div>
<div class="line">    &quot;${workspaceFolder}/python/tests&quot;</div>
<div class="line">  ],</div>
<div class="line">}</div>
</div><!-- fragment --><p>If the Python bindings are built (with <code>NEML2_PYBIND</code> set to <code>ON</code>) but are not installed to the site-packages directory, pytest will not be able to import the neml2 package unless the environment variable <code>PYTHONPATH</code> is modified according to the specified build directory. For Visual Studio Code users, create a <code>.env</code> file in the repository's root and include an entry <code>PYTHONPATH=build/python</code> (assuming the build directory is <code>build</code>), and the Python extension will be able to import the NEML2 Python package. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0 </li>
  </ul>
</div>
</body>
</html>
